language: node_js

services:
  - docker

node_js:
  - '12.14.0'

env:
  global:
  - ELECTRON_CACHE=$HOME/.cache/electron
  - ELECTRON_BUILDER_CACHE=$HOME/.cache/electron-builder
cache: npm


filter_secrets: false

addons:
  hostname: localhost
  artifacts:
    s3_region: "us-west-1"
    debug: true
    paths:
      - ./openworld-desktop/dist/*.exe

jobs:
  include:
    - stage: Tests
      os: Windows
      env: YARN_GPG=no
      script:
        - cd openworld-desktop
        - npm install
#        - npm copy-bindings
        - npm run build:web
        - npm run build
        - 'npm run test:all || (node ./upload-vrt.js && exit 1)'

